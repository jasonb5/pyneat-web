{% extends "base.html" %}

{% block breadcrumbs %}
<li>
  <a href="{% url 'experiment' org.population.experiment.pk %}">Experiment</a>
</li>
<li>
  <a href="{% url 'population' org.population.pk %}">Population</a>
</li>
<li>
  <a href="{% url 'generation' org.generation.pk %}">Generation</a>
</li>
<li>
  <a href="{% url 'species' org.species.pk %}">Species</a>
</li>
<li class="active">
  <a href="{% url 'organism' org.pk %}">Organism</a>
</li>
{% endblock %}

{% block content %}
<div class="column-group">
  <div class="all-100">
    <table class="ink-table bordered">
    {% for k, v in fields.items %}
      <tr>
        <td>{{ k }}</td>
        <td>{{ v }}</td>
      </tr>
    {% endfor %}
    </table>
  </div>
</div>
<div class="column-group">
  <div class="all-50 medium-100">
    <div id="neural-network"></div>
  </div>
  <div class="all-50 medium-100">
    <div id="spec-graph"></div>
  </div>
</div>

<script type="text/javascript">
  var nodes = new vis.DataSet();
  var edges = new vis.DataSet();

{% for k, v in neurons.items %}
  {% for n in v %}
  nodes.add({
    id: {{ n.0 }},
    label: '{{ k }} {{ n.0 }}',
    level: {{ n.1 }},
  });
  {% endfor %}
{% endfor %}

{% for g in genes %}
  edges.add({
    from: {{ g.inode }}, 
    to: {{ g.onode }},
    arrows: 'to',
    label: '{{ g.weight }}',
    font: {
      align: 'top',
    },
  });
{% endfor %}

  var container = document.getElementById('neural-network');
  var data = {
    nodes: nodes,
    edges: edges,
  };
  var options = {
    width: '600px',
    height: '400px',  
    layout: {
      hierarchical: {
        direction: 'LR',
        levelSeparation: 300,
        nodeSpacing: 300,
      }
    },
  };
  var network = new vis.Network(container, data, options);

  var xdata = [];
  var ydata = [];

{% for spec in spec_fitness %}
  xdata.push({{ spec.rel_index }});
  ydata.push({{ spec.fitness }});
{% endfor %}

  var data = [
    {
      x: xdata,
      y: ydata,
      type: 'bar',
    }
  ];

  Plotly.newPlot('spec-graph', data);
</script>

{% endblock %}
